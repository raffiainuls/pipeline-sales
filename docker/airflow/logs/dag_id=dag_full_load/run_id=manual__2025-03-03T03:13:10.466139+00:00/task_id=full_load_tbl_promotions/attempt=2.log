[2025-03-03T03:21:15.500+0000] {taskinstance.py:1103} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: dag_full_load.full_load_tbl_promotions manual__2025-03-03T03:13:10.466139+00:00 [queued]>
[2025-03-03T03:21:15.518+0000] {taskinstance.py:1103} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: dag_full_load.full_load_tbl_promotions manual__2025-03-03T03:13:10.466139+00:00 [queued]>
[2025-03-03T03:21:15.519+0000] {taskinstance.py:1308} INFO - Starting attempt 2 of 3
[2025-03-03T03:21:15.844+0000] {taskinstance.py:1327} INFO - Executing <Task(PythonOperator): full_load_tbl_promotions> on 2025-03-03 03:13:10.466139+00:00
[2025-03-03T03:21:15.873+0000] {standard_task_runner.py:57} INFO - Started process 1405 to run task
[2025-03-03T03:21:15.877+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'dag_full_load', 'full_load_tbl_promotions', 'manual__2025-03-03T03:13:10.466139+00:00', '--job-id', '21', '--raw', '--subdir', 'DAGS_FOLDER/dag_full_load.py', '--cfg-path', '/tmp/tmpsr2rrj28']
[2025-03-03T03:21:15.880+0000] {standard_task_runner.py:85} INFO - Job 21: Subtask full_load_tbl_promotions
[2025-03-03T03:21:15.953+0000] {logging_mixin.py:149} WARNING - /home/***/.local/lib/python3.7/site-packages/***/settings.py:195 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2025-03-03T03:21:16.055+0000] {task_command.py:410} INFO - Running <TaskInstance: dag_full_load.full_load_tbl_promotions manual__2025-03-03T03:13:10.466139+00:00 [running]> on host 9b8c8285a7ac
[2025-03-03T03:21:16.828+0000] {taskinstance.py:1547} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='Raffi' AIRFLOW_CTX_DAG_ID='dag_full_load' AIRFLOW_CTX_TASK_ID='full_load_tbl_promotions' AIRFLOW_CTX_EXECUTION_DATE='2025-03-03T03:13:10.466139+00:00' AIRFLOW_CTX_TRY_NUMBER='2' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-03-03T03:13:10.466139+00:00'
[2025-03-03T03:21:16.836+0000] {logging_mixin.py:149} INFO - Processing Loading Configuration.....
[2025-03-03T03:21:16.841+0000] {logging_mixin.py:149} INFO - Configuration Finished Load
[2025-03-03T03:21:16.842+0000] {logging_mixin.py:149} INFO - usernamenya pakai apa nih: postgres
[2025-03-03T03:21:16.907+0000] {taskinstance.py:1824} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1886, in _execute_context
    cursor, statement, parameters, context
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 988, in do_executemany
    **kwargs
  File "/home/airflow/.local/lib/python3.7/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
psycopg2.errors.UndefinedColumn: column "Unnamed: 0" of relation "tbl_promotions" does not exist
LINE 1: INSERT INTO public.tbl_promotions ("Unnamed: 0", id, event_n...
                                           ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/operators/python.py", line 181, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/operators/python.py", line 198, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/full_load_tbl_promotions.py", line 33, in full_load_tbl_promotions
    full_load_postgres(DB_USER, DB_PASSWORD, DB_HOST, DB_PORT, DB_NAME, SCHEMA_NAME, TABLE_NAME, engine, create_table_query, df)
  File "/opt/airflow/dags/full_load_postgres.py", line 41, in full_load_postgres
    df.to_sql(TABLE_NAME, engine, schema=SCHEMA_NAME, if_exists='append', index=False)
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/core/generic.py", line 2882, in to_sql
    method=method,
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 728, in to_sql
    **engine_kwargs,
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 1770, in to_sql
    **engine_kwargs,
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 1350, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 1340, in insert_records
    table.insert(chunksize=chunksize, method=method)
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 967, in insert
    exec_insert(conn, keys, chunk_iter)
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 882, in _execute_insert
    conn.execute(self.table.insert(), data)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/sql/elements.py", line 335, in _execute_on_connection
    self, multiparams, params, execution_options
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1587, in _execute_clauseelement
    cache_hit=cache_hit,
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1949, in _execute_context
    e, statement, parameters, cursor, context
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 2130, in _handle_dbapi_exception
    sqlalchemy_exception, with_traceback=exc_info[2], from_=e
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1886, in _execute_context
    cursor, statement, parameters, context
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 988, in do_executemany
    **kwargs
  File "/home/airflow/.local/lib/python3.7/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "Unnamed: 0" of relation "tbl_promotions" does not exist
LINE 1: INSERT INTO public.tbl_promotions ("Unnamed: 0", id, event_n...
                                           ^

[SQL: INSERT INTO public.tbl_promotions ("Unnamed: 0", id, event_name, disc, time, created_at) VALUES (%(UnnamedC_0)s, %(id)s, %(event_name)s, %(disc)s, %(time)s, %(created_at)s)]
[parameters: ({'UnnamedC_0': 0, 'id': 1, 'event_name': 'New Year (2025-01-01)', 'disc': 5, 'time': '2025-01-01', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 1, 'id': 2, 'event_name': 'End of January Sale (2025-01-31)', 'disc': 5, 'time': '2025-01-31', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 2, 'id': 3, 'event_name': 'Chinese New Year (2025-02-10)', 'disc': 7, 'time': '2025-02-10', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 3, 'id': 4, 'event_name': "Valentine's Day (2025-02-14)", 'disc': 9, 'time': '2025-02-14', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 4, 'id': 5, 'event_name': 'End of February Sale (2025-02-28)', 'disc': 8, 'time': '2025-02-28', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 5, 'id': 6, 'event_name': "International Women's Day (2025-03-08)", 'disc': 6, 'time': '2025-03-08', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 6, 'id': 7, 'event_name': 'Nyepi Day (2025-03-11)', 'disc': 6, 'time': '2025-03-11', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 7, 'id': 8, 'event_name': "St. Patrick's Day (2025-03-17)", 'disc': 7, 'time': '2025-03-17', 'created_at': '2025-03-03 01:39:25'}  ... displaying 10 of 36 total bound parameter sets ...  {'UnnamedC_0': 34, 'id': 35, 'event_name': 'Boxing Day (2025-12-26)', 'disc': 10, 'time': '2025-12-26', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 35, 'id': 36, 'event_name': 'End of December Sale (2025-12-31)', 'disc': 10, 'time': '2025-12-31', 'created_at': '2025-03-03 01:39:25'})]
(Background on this error at: https://sqlalche.me/e/14/f405)
[2025-03-03T03:21:16.963+0000] {taskinstance.py:1350} INFO - Marking task as UP_FOR_RETRY. dag_id=dag_full_load, task_id=full_load_tbl_promotions, execution_date=20250303T031310, start_date=20250303T032115, end_date=20250303T032116
[2025-03-03T03:21:17.103+0000] {standard_task_runner.py:109} ERROR - Failed to execute job 21 for task full_load_tbl_promotions ((psycopg2.errors.UndefinedColumn) column "Unnamed: 0" of relation "tbl_promotions" does not exist
LINE 1: INSERT INTO public.tbl_promotions ("Unnamed: 0", id, event_n...
                                           ^

[SQL: INSERT INTO public.tbl_promotions ("Unnamed: 0", id, event_name, disc, time, created_at) VALUES (%(UnnamedC_0)s, %(id)s, %(event_name)s, %(disc)s, %(time)s, %(created_at)s)]
[parameters: ({'UnnamedC_0': 0, 'id': 1, 'event_name': 'New Year (2025-01-01)', 'disc': 5, 'time': '2025-01-01', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 1, 'id': 2, 'event_name': 'End of January Sale (2025-01-31)', 'disc': 5, 'time': '2025-01-31', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 2, 'id': 3, 'event_name': 'Chinese New Year (2025-02-10)', 'disc': 7, 'time': '2025-02-10', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 3, 'id': 4, 'event_name': "Valentine's Day (2025-02-14)", 'disc': 9, 'time': '2025-02-14', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 4, 'id': 5, 'event_name': 'End of February Sale (2025-02-28)', 'disc': 8, 'time': '2025-02-28', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 5, 'id': 6, 'event_name': "International Women's Day (2025-03-08)", 'disc': 6, 'time': '2025-03-08', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 6, 'id': 7, 'event_name': 'Nyepi Day (2025-03-11)', 'disc': 6, 'time': '2025-03-11', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 7, 'id': 8, 'event_name': "St. Patrick's Day (2025-03-17)", 'disc': 7, 'time': '2025-03-17', 'created_at': '2025-03-03 01:39:25'}  ... displaying 10 of 36 total bound parameter sets ...  {'UnnamedC_0': 34, 'id': 35, 'event_name': 'Boxing Day (2025-12-26)', 'disc': 10, 'time': '2025-12-26', 'created_at': '2025-03-03 01:39:25'}, {'UnnamedC_0': 35, 'id': 36, 'event_name': 'End of December Sale (2025-12-31)', 'disc': 10, 'time': '2025-12-31', 'created_at': '2025-03-03 01:39:25'})]
(Background on this error at: https://sqlalche.me/e/14/f405); 1405)
[2025-03-03T03:21:17.134+0000] {local_task_job_runner.py:225} INFO - Task exited with return code 1
[2025-03-03T03:21:17.519+0000] {taskinstance.py:2651} INFO - 0 downstream tasks scheduled from follow-on schedule check
